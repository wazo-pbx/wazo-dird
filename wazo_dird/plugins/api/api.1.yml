swagger: '2.0'
info:
  title: wazo-dird
  description: |
    Contacts and directories in Wazo are managed by the wazo-dird daemon.

    This service provides a public API that can be used to query the directories that are configured on a Wazo.

    A contact can contain various information such as a person's phone number, number, office number, department, office number,
    etc. The information displayed is selected via a profile. Directories can be aggregated using multiple data sources such as
    an LDAP server, a CSV file, another Wazo server, etc.

    Please refer to [the documentation](http://documentation.wazo.community) for further details.

    Note: The 1 API is currently in development. Major changes will happen with this version until it is considered stable.
  version: '1'
  license:
    name: GPL v3
    url: http://www.gnu.org/licenses/gpl.txt
  contact:
    name: Dev Team
    url: http://wazo.community
    email: dev@wazo.community
x-xivo-port: 9489
x-xivo-name: dird
schemes:
- https
basePath: /1
consumes:
- application/json
produces:
- application/json
securityDefinitions:
  wazo_auth_token:
    type: apiKey
    name: X-Auth-Token
    in: header
security:
- wazo_auth_token: []
responses:
  InvalidParameters:
    description: Invalid parameters
    schema:
      $ref: '#/definitions/Error'
  ProfileInvalid:
    description: The profile does not exist
    schema:
      $ref: '#/definitions/Error'
  AnotherServiceUnavailable:
    description: Another service is unavailable (e.g. wazo-auth, postgresql, ...)
    schema:
      $ref: '#/definitions/Error'
  LimitOffsetInvalid:
    description: The limit or offset should be positive
    schema:
      $ref: '#/definitions/Error'
  DuplicateFavorite:
    description: The contact has already been favorited
    schema:
      $ref: '#/definitions/Error'
  DuplicateContact:
    description: This contact already exists
    schema:
      $ref: '#/definitions/Error'
parameters:
  AcceptLanguage:
    name: Accept-Language
    in: header
    type: string
    required: false
    description: The language to translate the query results in
  ContactID:
    name: contact_id
    in: path
    type: string
    required: true
    description: The ID of contact.
  direction:
    required: false
    name: direction
    in: query
    type: string
    enum:
    - asc
    - desc
    description: Sort list of items in 'asc' (ascending) or 'desc' (descending) order
  Directory:
    name: directory
    in: path
    type: string
    description: The directory where the contact is stored.
    required: true
  Exten:
    name: exten
    in: query
    type: string
    description: A search exten to look for
    required: true
  FavoriteID:
    name: contact
    in: path
    type: string
    description: The ID of the contact. This ID is unique within the {directory}.
    required: true
  Limit:
    name: limit
    in: query
    type: integer
    description: The limit defines the number of individual objects that are returned
    required: false
  Limit8:
    name: limit
    in: query
    type: integer
    description: The limit defines the number of individual objects that are returned
    default: 8
    required: false
  Limit16:
    name: limit
    in: query
    type: integer
    description: The limit defines the number of individual objects that are returned
    default: 16
    required: false
  Offset:
    name: offset
    in: query
    type: integer
    description: The offset defines the offsets the start by the number specified
    default: 0
    required: false
  order:
    required: false
    name: order
    in: query
    type: string
    description: Name of the field to use for sorting the list of items returned.
  Profile:
    name: Wazo-Dird-Profile
    in: header
    type: string
    description: The profile defines the list of directories to query and how the
      results are displayed. `default` is used if no profile is specified
    required: false
  recurse:
    name: recurse
    in: query
    type: boolean
    description: Should the query include sub-tenants
    default: false
    required: false
  tenantuuid:
    name: Wazo-Tenant
    type: string
    in: header
    description: "The tenant's UUID, defining the ownership of a given resource."
    required: false
  ProxyUrl:
    name: Proxy-URL
    in: header
    type: string
    required: false
    description: URL that will be integrated in the XML response. (not working on
      swagger 2.1)
  search:
    required: false
    name: search
    in: query
    type: string
    description: Search term for filtering a list of items. Only items with a field
      containing the search term will be returned.
  Term:
    name: term
    in: query
    type: string
    description: A search term to look for
    required: true
  UserUUID:
    name: user_uuid
    in: path
    type: string
    description: The user UUID on which the result is associated. use `me` when using the user of the token
    required: true
  XivoUserUUID:
    name: xivo_user_uuid
    in: path
    type: string
    description: The XiVO user uuid on which the result is associated (e.g. used to
      search in personal contacts)
    required: true
definitions:
  Error:
    title: Error
    description: Error message for the client
    properties:
      timestamp:
        description: Time at which the error occured
        type: array
        items:
          type: number
          format: timestamp
      reason:
        description: Human readable explanation of the error
        type: array
        items:
          type: string
      status_code:
        description: HTTP status code
        type: integer
  Header:
    properties:
      column_headers:
        type: array
        description: Labels for the headers
        items:
          type: string
      column_types:
        type: array
        description: Data types for the headers
        items:
          type: string
  ContactItem:
    properties:
      display_name:
        type: string
        description: The name that should be displayed when showing that contact
      first_name:
        type: string
        description: The given name of the contact
      last_name:
        type: string
        description: The surname of the contact
      middle_name:
        type: string
        description: The middle name of the contact
      company_name:
        type: string
        description: "The name of the contact's company"
      addresses:
        type: array
        description: A list of contact addresses
        items:
          $ref: '#/definitions/LabeledAddress'
      emails:
        type: array
        description: A list of contact email addresses
        items:
          $ref: '#/definitions/LabeledEmails'
      phones:
        type: array
        description: A list of contact phone numbers
        items:
          $ref: '#/definitions/LabeledPhoneNumbers'
    required:
      - backend
      - source_uuid
  LabeledAddress:
    properties:
      label:
        type: string
        description: A description of the address
      address:
        type: string
  LabeledEmails:
    properties:
      label:
        type: string
        description: A description of the email address
      email:
        type: string
  LabeledPhoneNumbers:
    properties:
      label:
        type: string
        description: A description of the phone number
      number:
        type: string
  ContactList:
    properties:
      items:
        type: array
        items:
          $ref: '#/definitions/ContactItem'
      total:
        type: number
        description: The number of contacts matching thie searched term
  Relation:
    properties:
      wazo_uuid:
        type: string
        description: The UUID of the Wazo instance of that contact
      user_id:
        type: string
        description: The confd ID of the Wazo user if that contact is a Wazo user
      user_uuid:
        type: string
        description: The auth UUID of the Wazo user if that contact is a Wazo user
      line_ids:
        type: array
        items:
          type: string
        description: A list of line IDs owned by that contact
      agent_id:
        type: string
        description: The agent ID if this contact is an agent
      source_entry_id:
        type: string
        description: The ID of the contact in its source (used to mark a contact as favorite)
      backend:
        type: string
        description: The type of the source which returned this contact
      source_uuid:
        type: string
        description: The UUID of the source which returned this contact
  Source:
    properties:
      uuid:
        type: string
        description: The source's UUID
        readOnly: true
      name:
        type: string
        description: The source's name
      searched_columns:
        type: array
        items:
          type: string
          description: A list of columns which should be searched when doing a look up
      first_matched_columns:
        type: array
        items:
          type: string
        description: A list of columns which should be searched when doing a reverse look up
      format_columns:
        type: object
        description: A mapping of new fields and a python format string to generate the new columns value
  SourceItems:
    properties:
      total:
        type: integer
        description: The number of configured sources for this backend
        readOnly: true
      filtered:
        type: integer
        description: The number of configured sources matching the searched terms for this backend
        readOnly: true
  PhonebookContact:
    properties:
      id:
        type: string
      firstname:
        type: string
      lastname:
        type: string
  PhonebookContactList:
    type: array
    items:
      $ref: '#/definitions/PhonebookContact'
  ContactBodySample:
    properties:
      firstname:
        type: string
      lastname:
        type: string
  ContactImportResponse:
    properties:
      created:
        $ref: '#/definitions/PhonebookContactList'
      failed:
        type: array
        items:
          $ref: '#/definitions/ContactImportFailure'
  ContactImportFailure:
    properties:
      line:
        type: integer
      errors:
        type: array
        items:
          type: string
  PhonebookBody:
    properties:
      name:
        type: string
      description:
        type: string
    required:
    - name
  Phonebook:
    properties:
      id:
        type: integer
      name:
        type: string
      description:
        type: string
  Reverse:
    properties:
      display:
        type: string
      exten:
        type: string
        description: A search exten to look for
      source:
        type: string
      fields:
        description: Fields defined for each source
        $ref: '#/definitions/ResultFields'
    required:
    - display
    - exten
    - fields
    - source
  ResultFields: {}
  WazoAuthConfig:
    title: Auth
    allOf:
      - $ref: '#/definitions/ExternalServiceConfig'
      - $ref: '#/definitions/WazoAuthConfigNoAuth'
      - properties:
          key_file:
            type: string
            description: The path the the file containing the credentials
          username:
            type: string
            description: The username to use when not using a key_file
          password:
            type: string
            description: The password to use when not using a key_file
  WazoAuthConfigNoAuth:
    title: Auth
    allOf:
      - $ref: '#/definitions/ExternalServiceConfig'
      - properties:
          port:
            type: integer
            default: 9497
          version:
            type: string
            default: "0.1"
  ExternalServiceConfig:
    properties:
      host:
        type: string
        default: localhost
      verify_certificate:
        type: string
        description: If the HTTPs certificates should be verified and the path of the certificate if a custom certificate is used.
        default: true
      timeout:
        type: number
  ConfdConfig:
    title: Confd
    allOf:
      - $ref: '#/definitions/ExternalServiceConfig'
      - properties:
          port:
            type: integer
            default: 9486
          https:
            type: boolean
            default: true
          version:
            type: string
            default: "1.1"
